Fine tuning classical and quantum molecular dynamics using a generalized Langevin equation
Generalized Langevin Equation (GLE) thermostats have been used very effectively as a tool to manipulate and optimize the sampling of thermodynamic ensembles and the associated static properties. Here we show that a similar, exquisite level of control can be achieved for the dynamical properties computed from thermostatted trajectories. We develop quantitative measures of the disturbance induced by the GLE to the Hamiltonian dynamics of a harmonic oscillator, and show that these analytical results accurately predict the behavior of strongly anharmonic systems. We also show that it is possible to correct, to a significant extent, the effects of the GLE term onto the corresponding microcanonical dynamics, which puts on more solid grounds the use of non-equilibrium Langevin dynamics to approximate quantum nuclear effects and could help improve the prediction of dynamical quantities from techniques that use a Langevin term to stabilize dynamics. Finally we address the use of thermostats in the context of approximate path-integral-based models of quantum nuclear dynamics. We demonstrate that a custom-tailored GLE can alleviate some of the artifacts associated with these techniques, improving the quality of results for the modeling of vibrational dynamics of molecules, liquids, and solids.
I. INTRODUCTION
Dynamical properties of the ionic degrees of freedom of a material or a molecule provide a direct connection to experimental observables such as vibrational spectra, diffusion coefficients, reaction rates, and heat conductance, among others. Their evaluation from atomistic simulations is typically more challenging than the evaluation of static ensemble properties, especially when taking into account nuclear quantum effects (NQEs). To name only a few reasons for this greater challenge, one must ensure sufficient sampling, but in a standard simulation thermostats often cannot be used to aid this task since their presence modifies dynamical properties. Moreover, no method exists that can include exactly and affordably nuclear quantum effects in the dynamics of complex high-dimensional systems. The many approximate methods available that are based on path integral molecular dynamics [1–3] (PIMD) suffer from one or another unphysical artifact [3–5].
Generalized Langevin Equation (GLE) thermostats emerged as an efficient tool for the control and evaluation of static properties in simulations relying on both classical and quantum descriptions of the nuclei [6–8]. In order to obtain a targeted GLE kernel for the static ensemble properties of interest, one can define, in a reasonably straightforward manner, target quantities that measure the performance of the GLE dynamics when applied to the actual system [8]. By defining different fitting targets, it is possible to build thermostats that act only on a specific set of vibrational modes [6], that are efficient in a wide frequency range [8], that mimic nuclear quantum fluctuations [7], and many other possibilities [9,10].
In this paper, we study and show how GLE thermostats can be used in order to control dynamical properties of various systems. We develop a framework for the optimization of GLE matrices where we construct simple dynamical models and define new target quantities sensitive to dynamical information. We take as paradigmatic examples the vibrational spectra of water ranging from the isolated molecule and protonated clusters, all the way to the condensed phase. On one hand, we show how the disturbance due to the GLE dynamics in simulations with classical nuclei can be predicted and how the perturbed spectra can be deconvoluted to recover the unperturbed density of states. On the other hand, we take advantage of the freedom that thermostatted ring polymer molecular dynamics (TRPMD) [3] leaves in the choice of the thermostat attached to the internal modes of the ring polymer in order to design GLE matrices that reduce the spurious broadening of high-frequency spectral features that was observed in the original formulation based on a white noise thermostat [3,11]. In both cases, we demonstrate that the same GLE framework can be used to manipulate, to a considerable extent, the dynamical behavior of the system.
Throughout this work, we also take special attention to perform our dynamics using accurate potential energy surfaces that include all physically relevant effects for the systems in question. For the molecules, we use extremely accurate parametrized potentials [12,13], and for the condensed phase simulations we use neural network potentials fitted to accurate density-functional theory data [14,15]. In Sec. II, we explain our models and fitting procedures in detail, showcasing the rationale of our development with toy examples. In Sec. III, we first detail how we can predict and deconvolute the GLE disturbance on classical molecular dynamics and then show how fitted GLE matrices can change the outcome of TRPMD simulations. Finally, in Sec. IV, we draw our conclusions.
II. THEORY AND METHODS
The use of a history-dependent Langevin equation to model the coupling between a system and a canonical heat bath has been discussed many times [16]. Such generalized Langevin equations (GLEs) have been employed extensively as a tool to study reaction rates [17], to model open systems [18], and as a general sampling device whose properties can be formally quantified [19,20]. The use of a GLE as a highly tunable thermostatting scheme for atomistic simulations has also been discussed at length elsewhere [8,21]. For the sake of completeness and to introduce our notation, we will briefly summarize the basic ideas, before discussing in more detail how this GLE framework can be used to obtain a precise control of the dynamics of a physical system.
A. A generalized Langevin equation thermostat
The generalized Langevin equation for a particle with unit mass in one dimension, subject to a potential V(q), is given by the non-Markovian process
where K(t) is the memory kernel that describes dissipation and ζ(t) is a Gaussian random process with a time correlation function H(t)=⟨ζ(t)ζ(0)⟩. Throughout this paper, we consider unit mass in all equations. The numerical integration of this equation is computationally challenging since it requires the knowledge of the entire history of the particle’s trajectory. However, exploiting the equivalence between the non-Markovian dynamics of Eq. (1) and Markovian dynamics in an extended space, n auxiliary degrees of freedom s can be coupled linearly to the physical momentum, which results in the Markovian Langevin equation
Here ξ is a n + 1 dimensional vector of uncorrelated Gaussian numbers. In order to label the portions of the matrices that describe the coupling between the different components of the extended state vector x≡(q,p,s){T}, we use the following notation:
Upon integrating out the auxiliary degrees of freedom, Eq. (1) is recovered with
where Z=∫0∞e^{−At}De^{−ATt}dt and D_{p}=B_{p}BpT. This implies that by tuning the elements of the matrices A_{p} and B_{p}, a Generalized Langevin equation with the desired friction kernel and noise correlation can be approximated within a Markovian framework. Note that although we focused on a one-dimensional case to simplify the notation, it is also possible to apply Eq. (2) to each Cartesian coordinate of an atomistic system. Since the overall dynamics is invariant to a unitary transformation of the coordinates, the response of the system would be the same as if the GLEs had been applied in, e.g., the normal modes coordinates.
B. Controlling classical dynamics
Let us consider a particle subject to a harmonic potential, V(q)=12ω02q^{2}, and coupled to a GLE. The time evolution of its state vector x = (q, p, s)^{T} can be expressed as
Since the force is linear in q, Eq. (5) takes the form of an Ornstein-Uhlenbeck (OU) process that can be written concisely as
Since its finite-time propagator is known analytically [22], it is possible to compute any time correlation function in terms of the drift and diffusion matrices A_{p} and B_{p}. For instance, the vibrational density of states (VDOS) can be computed exactly by taking the Fourier transform of the velocity-velocity correlation function and reads
where the stationary covariance matrix can be obtained by solving the Riccati equation A_{qp}C_{qp}+C_{qp}AqpT=B_{qp}BqpT.
It is useful to perform a spectral decomposition of Eq. (7) in order to gain more insight into the spectrum of a GLE-thermostatted oscillator. It is straightforward to show that by writing A_{qp}(ω_{0})=Odiag(Ω)O^{−1}, where O is the matrix of eigenvectors and Ω is a vector containing the corresponding eigenvalues, the expression for the velocity-velocity correlation function can be written as
For example, in the case of white-noise Langevin with friction γ, the correlation function reads
The spectrum in Eq. (8) corresponds to a sum of Lorentzian functions, with the peak positions and line shapes determined by the poles at ω=±iΩ_{j}. Motivated by this spectral decomposition, we define several quantities that give a concise description of the shape of the spectrum. After having introduced the integral function of the spectrum
which can be computed easily based on the same eigendecomposition of A_{qp}, we define the median
that characterizes the position of the peak, and the interquartile distance
that characterizes its width. Together, these two indicators are sufficient to determine fully a Lorentzian line shape
In order to quantify the presence of multiple poles or other sources of asymmetry in the line shape that are not captured by ω¯ and Δω, we introduce a “non-Lorentzian-shape” factor S,
According to the definitions above, a perfect δ-like Lorentzian spectrum would have ω¯∕ω_{0}=1, Δω∕ω_{0}=0, and S = 0. In order to exemplify how these measures behave in the case of a simple white noise thermostat attached to a harmonic oscillator, we show in Fig. 1 how the velocity-velocity spectra of oscillators of different frequency ω_{0} change with different regimes of white noise, and how the measures defined in Eqs. (11)–(14) relate to the magnitude of the perturbation induced to a δ-like spectrum shape.
Analyzing Fig. 1, we can see that, as expected, the regime that introduces the least disturbance to the VDOS is the underdamped regime (the limit where A_{p} = 0 is microcanonical dynamics)—and that for a given γ, the modes with lower frequency suffer the most pronounced relative disturbance. Focusing on the underdamped case, the measures ω¯∕ω_{0} and Δω∕ω_{0} predict the shift and broadening of the peaks at low frequencies, as well as the lack of disturbance at high frequencies. Going to the optimally damped and the overdamped case, the disturbances to the spectra get more pronounced through the whole range of frequencies, and it is easy to follow how the different indicators we introduced quantify this change. The S measure is always relatively small, indicating that a simple white-noise thermostat does not affect significantly the Lorentzian character of the peaks.
In the same spirit as the fitting procedure introduced in Ref [8], we define figures of merit that target these measures and complement the indicators of sampling efficiency that were previously introduced. By giving different weights to different targets and to different frequency ranges, it is possible to generate GLE thermostats that are designed to have a prescribed effect when applied to a given system. As we will show below, even in cases for which the GLE thermostat disturbs classical molecular dynamics in quite extreme ways, based on the analytical prediction of such disturbance one can recover the true dynamics of the underlying system.
C. Tuning thermostated ring polymer molecular dynamics
As shown in Ref [3], the formalism underlying thermostatted ring polymer molecular dynamics (TRPMD) leaves considerable freedom in the way thermostats are applied to the internal modes of the ring polymer. In the original algorithm, a simple white noise thermostat was used, which was tuned to give optimal sampling of the free ring polymer potential energy. Other choices for the white noise friction have been proposed, for instance, attempting to slow down the vibrations of internal modes to match those of the centroid [23]. Here we show that by optimizing quantitative measures of the interference of ring-polymer modes onto the dynamics of the centroid one, we can improve the outcome of TRPMD simulations in a wide range of systems.
Let us start by introducing a simple model of the coupling of a ring polymer mode to a physical (centroid) mode that we can use as the target of the GLE parameter optimization. In an actual ring polymer simulation, the lowest order coupling between centroid and non-centroid modes would be cubic (∝q_{0}q12), a term that would not be analytically treatable within an OU formalism. To obtain an expression that captures the nature of the anharmonic coupling, and that can be solved explicitly, we examine the OU process of two coupled harmonic oscillators where the s degrees of freedom are coupled to only one of them. The potential thus has the form
From here on, we denote ω_{0} the frequency of vibration of the physical system, ω_{1} the frequency of vibration of the ring polymer mode that we wish to couple a thermostat to, and α a parameter that controls the strength of the coupling. Obviously one could redefine the physical coordinates to obtain two decoupled normal modes. Here instead we analyze the dynamics of the original coordinates, so that the harmonic coupling serves as an analytically treatable model of the anharmonic coupling. As we will demonstrate, predictions based on this crude model provide a qualitative indication of the behavior in a real TRPMD simulation.
Extending the notation introduced in Eq. (3), the drift matrix A_{01} for this system can be written as
where we maintain the same notation for the GLE drift matrix A_{p}, with the understanding that it only couples to p_{1}. In order to measure the disturbances on the physical system, we use indicators similar to the ones in Eqs. (11)–(14) but slightly modified to capture the essence of this coupled oscillator problem. First, we can obtain analytical expressions for ω¯, Δω, and S defined as in Eqs. (11)–(14) but referring to the power spectrum for the momentum p_{0} of the physical mode, C_{p0p0}. These three quantities depend parametrically on A_{p}, ω_{1}, and α. In order to formulate the problem of optimising A_{p} in a more general way, we first consider that ω_{1} can be taken as the reference frequency relative to which one considers the frequency of the physical mode (i.e., we set ω_{1}=1 and aim to minimize the disturbance for all ω_{0}, smaller or larger than 1). Our final optimized matrices can be easily scaled by the target value of ω_{1} to which one wishes to attach the thermostat in a real calculation. In this work, we scale the matrices by the free ring polymer frequencies ω_{k}=2ω_{P}sin(kπ∕P), where ω_{P}=P∕(βℏ), β=1∕k_{B}T, and P is the number of beads in the ring polymer.
Since α is meant to represent a weak coupling term, we normalize our indicators based on their behavior for small α. This provides the following normalized target quantities:
which depend weakly on α (for numerical stability, we took α=0.4 in all of the calculations shown here). As measured by these quantities, a “perfect,” unperturbed spectrum should yield w_{shift}=w_{width}=w_{shape}=0.
One particular issue that we wish to address with this procedure is the artificial broadening of the peaks that is apparent in the original formulation of TRPMD [3] and especially bothersome for the spectra of molecules. The origin of this broadening can be understood by analyzing, for example, how the simplified model described by the drift matrix A_{01} behaves when one uses a simple white noise thermostat (a_{pp}=γ≠0,n_{s}=0). In Fig. 2, we show the quantities w_{shift}, w_{width}, and w_{shape}, as well as the Fourier transform of the friction kernel K(ω) and the predicted C_{pp} for three different values of ω_{0}. In all cases, we fix ω_{1}=1 and use α=0.4, that represents a fairly strong coupling, to exacerbate the effect.
In the underdamped regime (left-most panels of Fig. 2), first focusing on the plotted C_{pp}, we observe that when ω_{0}≪ω_{1}, the peak at ω_{0} becomes slightly red-shifted and a second low-intensity peak appears at ω_{1}. When ω_{0}=ω_{1}, the peak is split, corresponding to the well-known ring-polymer molecular dynamics (RPMD) resonance problem, that is well captured by this simplified coupling model. When ω_{0}≫ω_{1}, the physical peak is sharp and there is essentially no shift, but there is a residual (weak) resonance at ω_{1}. The measures introduced in Eqs. (17)–(19) reflect this behavior: The indicator w_{shift} predicts a larger disturbance for ω_{0}<ω_{1} than for ω_{0}>ω_{1}, while w_{width} and w_{shape} predict little broadening and non-Lorentzian line shape in both the ω_{0}<ω_{1} and ω_{0}>ω_{1} limits. When ω_{0}≈ω_{1}, the indicators correctly predict that the shift of the physical peak is not large (since the splitting is rather symmetric) but the width of the full (split) peak becomes larger. The large value of w_{shape} indicates the large deviation from a Lorentzian line shape. When the white noise friction on the ring-polymer mode is increased (moving to the right in Fig. 2), we observe that all indicators predict better spectra. However, when the peaks are in perfect resonance (ω_{0}=ω_{1}), optimal damping (γ=ω_{1}) is not sufficient. Even though the peak is not split anymore, its shape is far from Lorentzian, and one observes considerable broadening—compatible with the empirical observations for TRPMD. A certain broadening is also observed when ω_{0}≪ω_{1}. Within this model, the over-damped regime gives us the best result regarding our disturbance measures, which is also reflected in the predicted vibrational spectra. In that regime, the largest disturbance is observed at ω≈0, and the rest of the spectrum is clean. Note, however, that one cannot over-damp indefinitely. The further one goes in the overdamped regime for the ring polymer mode, the less efficient that mode is sampled, as can be measured by κ_{H}=τ_{H}∕ω_{1}, where τ_{H} is the autocorrelation time of the total energy for the ring-polymer mode. For this quantity, optimal sampling corresponds to κ_{H}=0.5. A very aggressive damping can make the simulation much less efficient and non-ergodic—a problem that can be mitigated by including sampling efficiency among the optimization targets.
What we will show in the following is that by using a colored noise thermostat one can get better results than with only white noise, even though the trade-off between disturbance and sampling efficiency always appears. In practice, we obtain the colored noise matrices by optimizing an objective function that combines the newly introduced indicators of dynamical disturbance, computed over a broad range of physical mode frequencies, together with sampling efficiency requirements for the ring-polymer mode, in the same framework as introduced in Ref [8]. We find, however, that the optimization has a pronounced tendency of finding local minima that nevertheless yield similar performances, as we discuss in more detail in Sec. II.
III. RESULTS AND DISCUSSION
In order to demonstrate the practical implications of the possibility of controlling the impact of thermostatting on classical and quantum dynamics, we have computed the velocity-velocity correlation spectra of many different systems—including both gas-phase molecules and condensed phases of water. For the latter, we used a neural-network (NN) potential [14,24] that has been fitted to match a density-functional model of water [15] based on the B3LYP hybrid functional with D3 empirical dispersion corrections [25] and shown to reproduce accurately the first-principles results for many of the properties of liquid water [26]. The general form of the NN potential ensures that the anharmonicity of the ab initio potential energy surface is fully reproduced—making these simulations a stringent test of the applicability of our analytical indicators beyond the harmonic limit. All simulations presented in the following have been performed through the interface of all relevant potentials with the i-PI code [27]. NN simulations were based on a plugin for the LAMMPS code [14].
A. Predicting and correcting the dynamical disturbance of a GLE
Equation (7) predicts the velocity-velocity correlation function for a harmonic oscillator of frequency ω_{0} subject to a given GLE. If one considers an assembly of independent oscillators of different frequencies, the total correlation function of the system can be written as ∑_{i}C(ω,ω_{i}). Taking the limit of a continuum distribution corresponding to the density of states g(ω), one can write
Note that if rather than the total velocity correlation function one were computing a linear combination of correlation functions (e.g., a dipole spectrum to which each oscillator contributes with its own transition dipole moment), Eq. (20) would still hold, with g(ω) representing a combination of the density of states and the weight of each mode. The question, of course, is how well this relation would hold in a real, anharmonic system, and how well the indicators of dynamical disturbance can be used to tune the behavior of the GLE dynamics—given that the kernel C(ω,ω^{′}) was derived under the assumption of harmonic dynamics. To benchmark this framework in a realistic scenario, we performed simulations of NN liquid water at 300 K and experimental density. We computed the vibrational density of states from a reference NVE simulation of the same model and then compared it with the Fourier transform of the velocity-velocity correlation function resulting from different kinds of GLE. Figure 3 shows the results for white-noise Langevin dynamics using different values of the friction and two GLE matrices (see the supplementary material). GLE(A) was designed to dramatically disturb all low-frequency modes, whereas GLE(B) was optimized to only affect modes within a narrow range of frequencies between 3000 and 4000 cm^{−1}. Not only one can see that the GLE spectrum is qualitatively distorted in accordance with the three indicators ω¯, Δω, and S(ω) but also that convoluting the NVE density of states according to Eq. (20) yields a near-perfect quantitative prediction of the GLE dynamics. These results open a path to the design of thermostats that only affect a portion of the frequencies while leaving the others untouched, as is the case for GLE(B).
Given the remarkable accuracy of the analytical prediction of the GLE dynamical disturbance, the possibility of performing the inverse operation arises—that is, to analytically predict the NVE density of states given the velocity-velocity correlation function obtained from a thermostatted run. This operation corresponds to a deconvolution of the GLE spectrum using C(ω,ω^{′}) as a convolution kernel. It is well-known that this class of inverse problems is very unstable and that an appropriate regularization is crucial to obtain sensible results that are not dominated by noise. Direct inversion using Tikhonov regularization with a Laplacian operator led to promising but unsatisfactory results. In particular, we found a tendency to obtain large spurious oscillations in the low-density parts of the spectrum, often leading to unphysical negative-valued curves.
We therefore used the Iterative Image Space Reconstruction Algorithm (ISRA) that enforces positive-definiteness of the solution [28,29]. Initializing the iteration with the GLE-computed velocity correlation spectrum, f_{0}(ω)=cvvGLE(ω), the ISRA amounts at repeated application of the iteration
where we have defined
The ISRA converges to a local solution satisfying ∫dxC(ω,x)f_{∞}(x)=cvvGLE(ω). We found that a convenient way to monitor the convergence is to compute at each step the residual and the Laplacian of f_{n},
Plotting (r_{n}, l_{n}) on a log-log scale reveals a behavior resembling a L-curve plot that can be used as a guide to avoid over-fitting—although in practice we find that the well-known slow asymptotic convergence of the ISRA effectively prevents reaching a situation in which f_{n} becomes too noisy. As can be seen from Fig. 3, this approach provides an excellent reconstruction of the true density of states even in cases in which the GLE dynamics distorts the spectrum of water beyond recognition. There are of course discrepancies, particularly in the low-frequency region that is both strongly anharmonic and harder to statistically converge. Nevertheless, the possibility of correcting for the disturbance induced by a GLE on the dynamics of complex atomistic systems opens up opportunities to obtain more accurate estimates of dynamical properties from simulations that use Langevin equations to stabilize trajectories [30] or contain intrinsic stochastic terms [31–34].
B. Dynamical properties from a quantum thermostat
Besides correcting dynamical properties in classical thermostatted simulations, this iterative reconstruction of the unperturbed DOS could be particularly helpful in another scenario. As mentioned in the Introduction, GLEs have been successfully applied as a tool to sample a non-equilibrium distribution in which different vibrational modes reach a stationary frequency-dependent effective temperature T^{⋆}(ω). In particular, the so-called “quantum thermostat” (QT) [7] and “quantum thermal bath” [35] try to enforce a temperature curve that mimics a quantum-mechanical distribution of energy in the normal modes of the system. Trying to maintain this temperature imbalance in an anharmonic system inevitably leads to zero-point energy leakage [36], i.e., cross talk between different normal modes that lead to deviations from the desired T^{⋆}(ω). This problem can be addressed by using a strongly coupled GLE [8] that results however in a pronounced disturbance of the system’s motion—making any inference on quantum effects on dynamical properties little more than guesswork. Being able to compensate for the dynamical disturbance induced by a GLE can make this approach somewhat more credible and less dependent on the details of the thermostat.
Figure 4 gives a demonstration of this idea—as well as a clear warning to the dangers of using the results of a quantum GLE without careful validation. Let us start by discussing the accuracy of the QT in terms of structural properties, for which we can obtain a reliable benchmark from a fully converged [26] PIMD simulation of the same NN model. As seen from the radial distribution functions, using a weakly coupled quantum thermostat [panel (a)] leads to significant zero-point energy leakage. The stretching modes show narrower fluctuations compared to PIMD, and the O–O distribution demonstrates a dramatic loss of structure, which is compatible with a much higher effective temperature of librational and translational modes. Increasing the coupling to the thermostat [panels (b) and (c)] improves significantly the structure of water that becomes very close to that from the PIMD simulation. This comes however at the price of a very pronounced disturbance of the dynamical properties that is most apparent in the low-frequency part of c_{vv}.
Moving on to dynamical properties, let us now discuss the relations between the (classical) density of states, the GLE spectrum, and the curves obtained by convolution and deconvolution through the kernel [37]C^{⋆}(ω,ω_{0})=mβC_{pp}(ω_{0})C(ω,ω_{0}). The deconvolution process corrects at the same time for dynamical disturbances and the frequency-dependent occupations of different normal modes, so any deviation between the reconstructed spectrum and the classical DOS is an indication of anharmonic effects and/or zero-point energy leakage that induces deviations from the target T^{⋆}(ω). As shown in the lower panel of Fig. 4, the iteratively reconstructed DOS displays the qualitative features one would expect from a quantum spectrum of water: the low-frequency modes are effectively unchanged relative to a classical DOS, whereas stretches and bends show a considerable red shift and broadening. The reconstructed spectra from panels (b) and (c)—that correspond to different but strongly coupled GLEs—are qualitatively very similar, particularly when contrasted with the weakly coupled GLE in panel (a). In the latter case, the low-frequency modes are overheated, leading to an overestimation of the DOS relative to the classical limit, and the stretching peak shows a blue shift, consistent with the fact that H-bonds are broken and stretch modes are underpopulated compared to the true quantum distribution.
While there is no absolute benchmark for quantum effects on dynamical properties of water, it is useful to compare the results from the “dynamically corrected” QT simulations with those from a TRPMD simulation. As shown in Fig. 5, the dynamical corrections do much more than rescaling frequencies by the QT occupations C_{pp}(ω_{0}). The heavily distorted low-frequency part of the spectrum becomes very close to the classical DOS, and small corrections are also applied to stretches and bending. While there is a considerable difference between the TRPMD spectrum and the corrected QT spectrum in the bending and stretching region, one should note that a similar discrepancy can be seen between TRPMD, centroid molecular dynamics (CMD), and other approximate quantum dynamical techniques [11]. As we will show in Fig. 10, one can observe a similar degree of frequency shift when using a modified TRPMD designed to minimize dynamical artifacts.
We conclude this analysis by stressing that even though we showed examples based on the quantum thermostat, a similar treatment is possible for the case of a quantum thermal bath, which, even if implemented differently, can be seen as a special case of the GLE framework in which the friction kernel is taken to be a δ distribution. Even though, whenever possible, one should cross-validate results with a more sophisticated technique such as CMD or (T)RPMD, the dynamical corrections we introduce to the quantum thermostat provide a practical solution for the cases in which one needs to assess the importance of quantum effects on dynamics but cannot afford a more accurate method.
C. Improving TRPMD spectra of molecular species
As we discussed above, one can extend the GLE model to assess the disturbance induced by the thermostatting of ring-polymer normal modes on the dynamics of the centroid. We wish to assess how the spurious broadening introduced by the white-noise thermostat in TRPMD can be controlled and diminished using GLE thermostats. We start by analyzing the vibrational density of states of molecules, where the spurious broadening is particularly dramatic. We consider the isolated water molecule, simulated with the Partridge-Schwenke (PS) [12] potential, and the Zundel cation (H_{5}O2+), simulated with the potential of Ref [13]. We performed all simulations at 100 K, where nuclear quantum effects become more apparent, and used 64 beads to ensure convergence of the quantum distribution.
Besides performing reference calculations with optimally coupled white-noise, we tested the behavior of two GLE matrices that were fitted to minimize the analytical measures of dynamical disturbance for centroid modes with frequencies two orders of magnitude above and below the ring-polymer frequency. We also optimized the sampling of the ring-polymer distribution as measured by the normalized autocorrelation rate κ_{H}=1∕ωτ_{H} of its total harmonic energy, in order to ensure it was not drastically inefficient. Depending on the weights given to the different target quantities, and on the starting parameters, the optimization can converge to different (local) minima. Even restricting ourselves to matrices corresponding to a single additional degree of freedom, we observed that similarly good performances—as measured by our analytical estimators—could be achieved with two distinct classes of 2×2A_{p} matrices. The first kind of matrices had large off-diagonal components corresponding to an exponential-like kernel [21], while those of the second kind are essentially dominated by their white noise component. We present the results for one matrix of each kind that given by
The indicators for these matrices are shown in Fig. 6. It is apparent that both yield very good (i.e., very low) w_{shift}, w_{width}, and w_{shape} for a wide range of frequencies, with GLE(C) being slightly better overall—at the expense of a lower κ_{H}. Since the matrices were fitted assuming a unit frequency of the ring-polymer mode, optimum parameters for each normal mode were obtained by multiplying the chosen A_{p} matrix by the free ring polymer frequencies at the relevant temperature.
In Fig. 7, we show the vibrational spectra of the isolated water molecule [panels (a)–(d)] and the Zundel cation [panels (e)–(h)] calculated with classical nuclei MD, with white noise TRPMD, with TRPMD+GLE(C), and with TRPMD+GLE(D). We show, in dashed lines, the spectra calculated from simulations allowing rotations of the molecule and, in full lines, the spectra where these rotations were filtered by changing the reference frame at each time step in a post-processing procedure. For reference, we also show the exact frequencies of vibration in the water potential, calculated at 0 K from Ref [38], and the multi-configurational time-dependent Hartree (MCTDH) OH stretch frequencies for the Zundel cation taken from Ref [39].
Focusing first on the spectra for the water molecule, we observe a considerable red shift of the OH stretch frequencies due to nuclear quantum effects, and all TRPMD simulations can capture this shift. White noise TRPMD, however, is slightly blue-shifted with respect to the exact results, while the new GLE TRPMD are basically on top of the reference. The over-broadening of white noise TRPMD is also clear—it cannot distinguish the splitting between symmetric and anti-symmetric stretches. The GLE thermostats make especially the OH stretch peaks narrower, and GLE(C) is even able to describe the splitting of the peak. For the OH-bend peak, we observe a red shift of 10 cm^{−1} for TRPMD and a blue shift of 20–30 cm^{−1} for GLE(C) and GLE(D), with respect to the exact result. White-noise and GLE thermostatting of the ring-polymer modes appear to have an impact on rotational dynamics that is only seen in the spectra that have not been cleaned from molecular rotations.
Despite having been designed to minimally impact the dynamics of physical modes, the two GLE thermostats alter the spectral signature of rotations. To qualitatively explain this effect, consider the cartoon representation of the rotation of a ring polymer depicted in Fig. 8. We propose that in this case, similar to what is seen for the RPMD resonance problem and the CMD curvature problem, the artifacts are associated with the strong coupling between a curvilinear motion of the centroid and the internal rearrangements of the ring polymer along an orthogonal coordinate. In this case, the overdamped dynamics of the internal degrees of freedom of the path hinder the (near)-free rotation of the ring polymer, resulting in an effective increase of the frequency of librations and rotations. A more quantitative analysis is far from straightforward. The case of the rotational dynamics of a single particle subject to white noise is discussed in Ref [40]. For a 2D rotor, one can compute analytically the orientational correlation function that exhibits two qualitatively different regimes (Gaussian vs. exponential) in the limits where the friction γ→0 and γ→∞. The generalization to three dimensions is considerably more complex, and a formulation that considers coupling to a GLE (that would in principle enable controlling and understanding these effects) is well beyond the scope of this work. Given that in several cases, the most pronounced manifestations of quantum nuclear effects involve high-frequency modes that do not have a rotational character, there are several circumstances in which this approach can prove useful. We observe that increasing the importance of the optimization of κ_{H} when designing the GLE does indeed ameliorate this artifact: For example, the blue shift is less pronounced for GLE(D) (for which κ_{H}=0.05) than for GLE(C) (κ_{H}=2⋅10^{−4}). However, in our current optimization there is a trade-off between the sharpness of the spectra and the optimization of κ_{H} (and thus the disturbance to the librations).
Moving now to the more complex spectrum of the Zundel cation, we first focus on the high frequency range of the spectrum, where nuclear quantum effects are expected to be most important. Comparing the classical, white noise TRPMD, and GLE TRPMD spectra, we observe that the GLE matrices behave according to the desired specifications: the peaks are sharper, making it possible to resolve the splitting between the OH stretch modes, and showing excellent agreement with the positions predicted by MCTDH for the same potential energy surface. Focusing next on the low frequency range, we observe that the GLE thermostats cause a strong blue shift in the bands in that region, if compared to the classical and the white-noise TRPMD simulations. These bands occur in a region of the spectrum where nuclear quantum effects are expected to be small. The classical VDOS should be a good approximation of the vibrational spectrum—and indeed the white-noise TRPMD spectrum is very similar to that from classical MD. Given the librational character of molecular motion in this frequency region, we believe that the blue shift that is apparent when using GLE(C), and GLE(D) is a manifestation of the unphysical coupling of the GLE thermostats to overall curvilinear dynamics of the molecules.
As a final demonstration of the improved performance of the optimized GLE thermostats for intra-molecular vibrational dynamics, Fig. 9 shows the dipole-dipole correlation spectrum for an isolated PS water molecule, using as a reference an exact quantum mechanical calculation of the dipole absorption spectrum performed using the code from Ref [41]. It can be seen that while TRPMD cannot capture fully the structure of the ro-vibrational spectrum, the position, the intensity, and the general line shape of the stretching and bending peaks are reproduced to an excellent degree. As observed in the other cases, white-noise TRPMD leads to a spurious broadening of the stretching peak, while TRPMD+GLE(C) leads to significant distortion of the zero-frequency rotational band, which does not however affect in an appreciable manner the intra-molecular vibrations.
D. Assessing the performance of TRPMD in the condensed phase
Having analyzed the successes and shortcomings of GLE-thermostatted TRPMD simulations of molecules, we now assess their behavior for condensed-phase simulations. The consistency of different quantum dynamics methods for the vibrational properties of water at different state points has been assessed in Ref [11] (where empirical potentials were used), and the performance of path integral methods for the vibrational properties of liquid water has been recently assessed on ab initio potential energy surfaces in Ref [42]. From these previous works, the conclusions were that different types of quantum dynamics in the same potential could give results in good overall agreement to each other and, regarding specifically TRPMD, that it also predicts high-frequency peaks that are considerably broader than predicted by other methods. It was also observed that quantitative details of the impact of nuclear quantum effects on vibrational spectra depend strongly on the potential energy surface (something that has also been noted for diffusion properties in water-based systems [43] and for optical excitations [44]).
We use the same NN trained on the DFT-B3LYP+D3 potential energy surface that we used to compute classical and quantum-thermostatted spectra and calculate the vibrational density of states of liquid water at 300 K and ice Ih at 100 K with TRPMD, using both optimally damped white noise and the GLE matrices discussed for the molecules. In Fig. 10, we show these vibrational spectra for water and ice (left and right panels, respectively) and compare them with the classical density of states.
First, in this case, the spectra of GLE(C) and GLE(D) are extremely similar for both liquid water and ice. In more detail, starting from the OH stretch region, we observe a narrowing of the peak in the vibrational spectra simulated with GLE(C)/(D) when compared to the white-noise TRPMD spectra. The line shape of the peak is also closer to the classical line shape. In the bend region, for liquid water, TRPMD and the GLE spectra agree almost perfectly, but for ice, the GLE spectra predict much narrower peaks. For the libration band, we detect an unphysical blue-shift of the bands of both liquid water and ice, with respect to the classical and TRPMD counterparts. Similar to what was observed for the molecules, the blue shift is (very) slightly more pronounced for GLE(C), which induces a strongly overdamped dynamics on the ring-polymer vibrations. Note that lattice vibrations of even lower frequency, as well as diffusion coefficients, do not suffer from these spurious effects. This confirms that the curvilinear nature of the molecular motion plays a key role in these artifacts. Finally, we observed that—due to the relatively low sampling efficiency of the ring-polymer modes for GLE(C)/(D)—it is somewhat harder to converge the populations of different normal modes when computing a vibrational density of states. In cases where this would constitute a problem, a simple solution consists in running multiple independent trajectories off a single imaginary-time PIMD simulation [45].
IV. CONCLUSIONS
In this paper, we have shown how Generalized Langevin Equation (GLE) thermostats can be used to manipulate the dynamical properties of physical systems in atomistic simulations, not only when treating nuclei as classical particles, but also when modeling their quantum mechanical nature. We have introduced analytically computable measures for the disturbance caused by the GLE to the intrinsic dynamics of harmonic models. Based on these indicators, it is possible to obtain thermostats with very specific characteristics.
For molecular dynamics with classical nuclei, where the GLE thermostats are coupled directly to the physical system, we can calculate analytically the velocity-velocity correlation spectrum of a harmonic oscillator coupled to a GLE. We show that even in strongly anharmonic systems such analytical predictions can be used to estimate the velocity-velocity correlation function in the presence of the GLE, through a convolution of the GLE spectrum with the underlying unperturbed vibrational density of states—although of course the corrections to strongly anharmonic properties should be considered qualitative unless thoroughly tested. This observation also allowed us to deconvolute the velocity-velocity spectrum from simulations run with a GLE thermostat and recover the underlying unperturbed density of states. This deconvolution procedure can be particularly useful in all circumstances in which a degree of thermostatting is needed to stabilize the dynamics, or to compensate for random errors in the evaluated forces. As an example, we consider the case of “quantum thermostats” that mimic quantum statistical distributions by enforcing a frequency-dependent steady-state temperature on different normal modes. By correcting the dynamical disturbance introduced by the strong coupling of these thermostats (which is necessary to prevent zero energy leakage), we put on more solid ground the practice of inferring dynamical information from these non-equilibrium, heavily thermostatted simulations.
When it comes to computing quantum dynamical correlation functions, one has to face the fact that no exact technique exists that can be taken as reference for condensed-phase (or large molecules) applications, making it more difficult to determine objective measures of the quality of a thermostatted trajectory. Approximate techniques based on the path integral formalism [1–3] generally rely on performing classical dynamics for the ring-polymer centroid, on top of the quantum mechanical thermal distribution. The idea is then to guarantee that centroid dynamics are not affected by the behavior of the ring-polymer modes that couple to the centroid by anharmonicities in the potential. We focused, in particular, on the thermostatted ring polymer molecular dynamics (TRPMD) method, since the underlying formalism leaves considerable freedom in choosing arbitrarily complex thermostats to be attached to the internal degrees of freedom of the ring polymer. We designed an analytically solvable model of the coupled centroid/internal mode dynamics and computed estimators of the shift, broadening, and general disturbance to the peak shape induced on the centroid. By optimizing these indicators for a broad range of centroid frequencies, we could significantly improve the quality of the vibrational spectra of gas-phase molecules—in particular for the high-frequency portion that is most affected by quantum mechanical effects.
The GLE-optimized TRPMD density of states separates high-frequency peaks that were blurred in the white-noise version of the method and yields peak positions that correspond to the ones predicted by reference methods in the same potential energy surface. The vibrational density of states for condensed phases of water also show sharper peaks in the stretch region. We note, however, that our treatment introduced an unexpected blue-shift on the rotational and librational modes that seems unphysical and prevents us from making quantitative comments on this intermediate range of frequencies. We link this problem to the coupling between curvilinear motion of the centroid and the relaxation time of the internal modes of the ring polymer. While in principle it might be possible to extend a GLE analysis to target rotational diffusion, and to reduce or remove this artifact, from a practical perspective, the present GLE optimization is enough to improve the TRPMD spectra in the frequency range for which NQEs are most prominent. However, when one is interested in NQE on lower-frequency vibrational modes like librations, white-noise TRPMD or CMD are still the best general-purpose simulation techniques. From a more fundamental point of view, it would be desirable to use the GLE framework in a less heuristic fashion, ideally deriving from first principles the most appropriate form to approximate exact quantum dynamics. One could, for example, try to derive GLEs that mimic properties of terms found in Matsubara dynamics which are not present in RPMD or CMD [46].
In summary, we demonstrated that the very same GLE framework that has been successful for tuning the equilibrium sampling properties of classical and quantum molecular dynamics can also be used to manipulate and correct the time-dependent behavior of a thermostatted trajectory. This approach can substantially extend the reach of many modeling techniques that rely on Langevin dynamics. For instance, it is now possible to estimate diffusion coefficients, or vibrational spectra, from simulations performed in constant-temperature conditions. The fact that we could also improve the quality of vibrational spectra obtained from approximate quantum dynamics techniques, based solely on the empirical goal of optimizing some measures of dynamical disturbance, underscores the potential of GLEs in this field. It also suggests that a more principled approach in deriving the appropriate form of the target memory kernels might inject additional physics into a family of methods that currently represent the most viable option to obtain time-dependent quantum mechanical observables for condensed-phase and large complex systems in general.
SUPPLEMENTARY MATERIAL
FIG. 1. 
Various regimes of the white noise thermostat acting on the harmonic oscillator. The left, central, and right panels, respectively, representing the under-damped (γ=0.1), optimally damped (γ=1), and over-damped limits (γ=10), show the velocity auto-correlation functions (top) and GLE metrics (bottom) for various values of the physical frequency. We choose three values for the physical mode ω_{0}, labeled in the picture and shown with different colors. The GLE metrics as defined by Eqs. (11)–(13) are represented by circular, plus shaped, and cross shaped markers, respectively.
FIG. 2. 
Various regimes of the white noise thermostat applied to the “ring-polymer” mode. The left, central, and right panels, respectively, representing the under-damped (γ=0.1), optimally damped (γ=1), and over-damped limits (γ=10), show the velocity auto-correlation function of physical mode (top) and GLE metrics (bottom) for various values of the physical frequency. In all cases we have taken ω_{1}=1. We choose three values for the physical mode ω_{0}, labeled in the picture and shown with different colors. The GLE metrics as defined by Eqs. (17)–(19) are represented by circular, plus shaped, and cross shaped markers, respectively.
FIG. 3. 
Each row reports the velocity-velocity correlation spectrum for a thermostatted simulation of liquid water at 300 K and experimental density (left) and the predicted measures of spectral disturbance [ω¯∕ω_{0}, Δω∕ω_{0}, and S(ω)] as a function of frequency, together with the GLE friction kernel K(ω) (right). The spectrum from the thermostatted trajectory (GLE) is compared with the density of states obtained from microcanonical runs (NVE), as well as with the spectrum predicted by convoluting the density of states with C(ω,ω_{0}) (NVE → GLE) and the density of states reconstructed by deconvoluting the thermostatted spectrum (GLE → NVE). The simulations were performed with a strong white-noise thermostat (a), a very-strong white-noise thermostat (b), a GLE designed to distort dramatically the whole spectrum (c), and a GLE designed to only affect the stretching peak [(d) with inset].
FIG. 4. 
The panels on the left report the velocity-velocity correlation functions, obtained from quantum-thermostatted simulations of liquid water at 300 K and constant experimental density. As in Fig. 3, the spectrum from a GLE simulation is compared with the NVE density of states, as well as with the transformed and reconstructed spectra. Panels on the right depict the radial O–O, H–H, and O–H distribution functions from the QT runs, compared with those from a converged PIMD calculation [26] (dashed lines). The topmost panels correspond to a weakly coupled GLE and the middle and bottom panels correspond to strongly coupled GLEs fitted independently (see the supplementary material for representative input files containing the parameters).
FIG. 5. 
A comparison between the classical vibrational density of states for a NN model of room-temperature water (NVE), that estimated from critically damped TRPMD (TRPMD), with the QT velocity-velocity correlation function scaled by C_{pp}(ω_{0}) (QT/⟨v⟩{2}) and finally the dynamically corrected QT (QT → NVE). The QT parameters are those used for panel (c) in Fig. 4.
FIG. 6. 
Indicators as given in Eqs. (17)–(19) for the GLE matrices used to thermostat the internal modes of the ring polymers in the TRPMD simulations shown in this paper.
FIG. 7. 
Vibrational density of states at 100 K of the water molecule and the Zundel cation calculated on the Partridge-Schwenke [12] potential and the potential of Bowman and co-workers [13], respectively. Panels (a)–(d) show classical nuclei MD, white noise TRPMD, TRPMD+GLE(C), and TRPMD+GLE(D) vibrational density of states of the water molecule, and panels (e)–(h) show the respective vibrational density of states for the Zundel cation. For each case, we show, in thin dashed lines, the spectra including rotational motion and, in full lines, the spectra where these rotations have been filtered out. The reference data, represented by thick dashed vertical lines, correspond to the one reported in Ref [38] for the water molecule and in Ref [39] for the Zundel cation.
FIG. 8. 
Cartoon representation of the origin of a blue shift of molecular degrees of freedom with a curvilinear nature, in the presence of an overdamped dynamics of ring polymer modes. In order for the centroid to move along a curvilinear coordinate, the ring polymer (described in Cartesian coordinates) has to rearrange and change orientation (green polymer). If the internal motion of the ring polymer is hindered (red), the system tends to move rigidly and it experiences a strong restoring force that increases the frequency of oscillation.
FIG. 9. 
Comparison of the dipole absorption spectrum obtained with TRPMD, TRPMD+GLEC, and the exact rovibrational spectrum considering J up to 24, obtained from the code of Ref [41].
FIG. 10. 
Vibrational density of states for bulk water at 300 K (left) and hexagonal ice at 100 K (right) calculated with classical MD and different flavors of TRPMD using the neural network potential based on B3LYP+D3 reference data.
