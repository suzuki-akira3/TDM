Molecular dynamics simulation of ion mobility in gases
A force field molecular dynamics method is developed to directly simulate ion drift in buffer gases driven by an electric field. The ion mobility and collision cross sections (CCSs) with relevance to ion mobility spectrometry can be obtained from the simulated drift velocity in high-density buffer gases (pressure ∼50 bars) and high electric fields (∼10^{7} V/m). Compared to trajectory methods, the advantage of the molecular dynamics method is that it can simultaneously sample the internal dynamic motions of the ion and the ion-gas collisions. For ions with less than 100 atoms, the simulated collision cross section values can be converged to within ±1%–2% by running a 100 ns simulation for 5–19 h using one computer core. By using a set of element-based Lennard-Jones parameters that are not tuned for different atomic types in different molecules, the simulated collision cross sections for 15 small molecular ions (number of atoms ranging from 17 to 85, mass ranging from 74.1 to 609.4 g/mol) are consistent with experimental values: the mean unsigned error is 2.6 Å^{2} for He buffer gas and 4.4 Å^{2} for N_{2} buffer gas. The sensitivity of the simulated CCS values to random diffusion, drift velocity, electric field strength, temperature, and buffer gas density is examined.
I. INTRODUCTION
Ion mobility spectrometry (IMS) [1–3] is an experimental method in that charged molecules (ions) are driven by an electric field to drift in a buffer gas. The collision cross section (CCS) of an ion in a specific buffer gas is a property that reflects the size, shape, and charge distribution of the ion. The IMS method has been routinely used for small drug-like compounds and hydrocarbons and large biological molecules such as proteins and nucleic acids [2,4–6]. It is of high interest to extract the structural information from the IMS measured drift velocity and mobility. This can be accomplished by using theoretical methods to calculate CCS values for molecular ions [7]. Several such theoretical methods have been proposed and implemented [8–18]. The simplest model assumes that each atom in the drift ion and the buffer gas molecule or atom is a hard sphere with a given radius so the CCS of the ion in the buffer gas can be estimated as the rotationally averaged projection area of the overlapping collision spheres centered at the ion atoms. The computational time for projection models are typically 2–10 min for ions with 50–100 atoms. For small and rigid ions, projection models with a set of parameterized radii can give accurate results. More sophisticated projection models are also available [19]. In general, however, more accurate collision models based on realistic intermolecular interactions must be used. The classical trajectory methods [8,18,20,21] use force field molecular dynamics simulation techniques to determine the scattering angles of buffer gas molecules or atoms by ions and relate the scattering angles to differential cross sections, which, after integration, yields the CCSs. The computational costs of trajectory methods are much higher than projection models. The main disadvantage of trajectory methods, at least in their current forms, is the lack of sufficient dynamic sampling of the ion structures, which could in principle have a significant influence on the drift velocity and CCS.
Here a molecular dynamics (MD) method is developed to directly simulate ion drift in buffer gases. As in IMS experiments, the CCS can be obtained from the drift velocity and the Mason-Schamp equation [22]. Compared to trajectory methods, the MD method fully considers the dynamic motions of the ion atoms in buffer gases, thus a more realistic method. The main difficulty in such MD simulations is the computational cost because a long simulation time such as 1 ms would be needed in order to mimic IMS experiments, in which the drift time is typically 1–10 ms, or even longer. This difficulty can be resolved by using a high buffer gas density and a high electric field, so the MD simulation time can be reduced to 10^{−4} ms (i.e., 100 ns) by using 5–19 h of computer time. Special velocity scaling schemes are designed to control the motion of the buffer gas molecules in a periodic boundary condition (PBC) box so they resemble those in IMS drift tubes. Numerical results suggest that MD simulations using these settings can produce CCS values that are consistent with experimental values.
In this paper, the theory of the MD simulation of ion mobility is presented first and then the details of the computational methods. The simulation results of 15 ions are discussed and some conclusions are drawn. To the best of our knowledge, this is the first time MD method is used to directly simulate ion drift and CCS in buffer gases.
II. THEORY
In a constant and uniform electric field E, an ion with charge q can drift in a buffer gas at a terminal drift velocity v. The electrical mobility μ_{q} is defined as
The diffusion coefficient D is related to the electrical mobility μ_{q},
Here k_{B} is the Boltzmann constant and T is the absolute temperature.
In principle, Born-Oppenheimer style molecular dynamic simulation of ion mobility can be performed by using accurate quantum chemical methods to describe the ion and buffer gas molecules in an applied electric field. To be practical, an efficient force field method can be used to approximate the quantum chemical methods. PBC can be used to reduce the number of buffer gas molecules in the MD simulation (Fig. 1). In a cubic box, a molecular ion and a number of buffer gas molecules (e.g., 256 He or N_{2}) are included. The total number of atoms in the simulation is N_{total} = N_{ion} + N_{gas}. The PBC is enforced by relocating the gas molecules to the box centered at the ion mass center; thus at any moment, the ion is surrounded by N_{gas} gas molecules (the minimum image convention [23]). The collision between the ion atoms and the gas atoms will drive the ion to undergo random translation, rotation, and vibration (as well as internal rotation). In an applied electric field, there is an additional net translation of the ion mass center. Due to the use of the minimum image convention, a cutoff should be used for the ion-gas interaction. Since the interaction between the ion and a gas molecule is mainly dispersion (decaying at the 6th and higher powers of the atom-atom distances) and dipole polarization (decaying at the 4th power of the atom-atom distances), a cutoff can be reasonably applied. Numerical results revealed that an atom-atom cutoff distance of 12 Å can be used because the induced dipole polarization energy is small at this distance. For example, the dipole polarizability of a N_{2} molecule is 11.74 bohrs^{3}, the induced-dipole polarization energy would be 0.014 kcal/mol in the electric field of a Na^{+} ion 12 Å (22.67 bohrs) away. In test calculations, longer cutoff distances such as 20 Å were used but no significant differences in the simulated CCS values were observed.
The buffer gas molecules will gain momentum and kinetic energy as the drift ion loses momentum and kinetic energy through collisions. The gained momentum and kinetic energy of the buffer gas are at an extremely low level (immeasurable) in IMS experiments because a large number of fresh buffer gas molecules are supplied at constant density and temperature. When PBC and a small number of buffer gas molecules or atoms are used in a MD simulation, the temperature and translational and angular momenta of the buffer gas should be controlled to mimic the experimental condition in that the gas molecules are randomly moving with a constant temperature but no translational and angular momenta. To control the buffer gas density, a constant volume can be used for the PBC box (no volume scaling). The temperature of the buffer gas can be controlled by using a special velocity scaling method, in which the translational and angular momenta of the buffer gas molecules are removed, and the velocities are scaled to match the desired temperature, for instance, 298.15 K. In short, the buffer gas in the MD system should be cooled down and rotationally stabilized to mimic the experimental condition. The gas molecules near the drift ion (in the collision region in Fig. 1) are exempted from the scaling because they are colliding with the ion atoms. The purpose of the velocity scaling procedure in the MD simulation is to maintain a fresh gas bath (the buffer region in Fig. 1) for the drift ion to collide. In this velocity scaling method, the translational momentum (equivalently, translational velocity) and the angular momentum (equivalently, rotational velocity around the gas mass center) of the gas molecules in the buffer region are determined and removed before the velocity scaling for each gas molecule. The Berendsen scaling scheme [24] is used for the gas molecules with a scaling factor of 1.0, which means that the temperature is scaled back to the desired bath temperature at every MD step. For gas phase molecules with weak interactions, this scaling does not introduce a significant perturbation to the motion of the gas molecules. Instead, too small a scaling factor may be problematic in effectively maintaining the gas randomness and bath temperature. A natural criterion for classifying gas molecules or atoms into the collision region is to use the PBC cutoff distance discussed in the previous paragraph: the gas molecules within the cutoff distance (e.g., 12 Å) to any ion atom are considered in the collision region. This is a reasonable criterion because all gas molecules having interactions with the ion atoms are automatically included in the collision region and only those out of the interaction range are in the buffer region. Of course, in order to maintain the randomness, the number of gas molecules in the buffer region should be much greater than that in the collision region. In a typical case with 256 gas molecules and a PBC box size of 61.15 Å, the box volume is 228 659.57 Å^{3}. A globular ion with a radius of 8 Å would have a spherical collision region with a radius of 20 Å and a volume about 33 510 Å^{3}, which is 15% of the total volume. For larger ions, larger PBC boxes should be used to ensure that the buffer region is much larger than the collision region. Gas molecules can move in and out of the collision region, so their locations are checked at every MD step. Using these settings, the MD simulation of the ion drift is performed in the constant particle number, constant volume, and constant temperature (NVT) ensemble of the buffer gas molecules.
The other issue is the MD simulation time. In one common type of IMS experiment, the drift tube is ∼0.2 m long filled with ∼5 mbar buffer gas. The drift time is ∼5 ms, corresponding to a velocity of ∼40 m s^{−1}. A MD simulation up to 5 ms would be difficult with a regular computer. However, if a much higher gas pressure, for example, 50 bars, is used in the MD simulation, the simulation time can be reduced by 10 000 times to 0.0005 ms or 500 ns. If a higher electric field (which means high E/N ratios like 10–60 Td) is used in the MD simulation, the ion can achieve a higher drift velocity (e.g., 100–250 m s^{−1}), so the simulation time can be further reduced to 100–200 ns. For a system with ∼350 atoms (N_{ion} ∼ 100, N_{gas} = 256), a MD simulation of 100 ns can be accomplished in 5–19 h by using one computer core. Nevertheless, a MD simulation of ion drift in a buffer gas can be performed in a realistic setting that resembles IMS experiments. Numerical results revealed that a high gas pressure of ∼50 bars and a high electric field of 10^{7} V m^{−1} can be used for typical small ions in N_{2} gas without causing too large deviations in CCSs from those measured in IMS experiments. A side effect of using high electric field is the dipole alignment of the ion. For a molecular ion with a dipole moment of 1.0 e Å (a unit charge 10 Å away from the center of mass of the ion), the dipole alignment energy of the ion in a 10^{7} V m^{−1} field would be 0.01 eV, which is 0.23 kcal/mol, comparable to the thermal rotational energy RT = 0.6 kcal/mol at 300 K. The dipole alignment is eliminated by a simple method in that the force acting on the ion by the applied external electric field is not explicitly calculated for each ion atom. Instead, the total force is calculated and distributed to each ion atom so each atom has exactly the same acceleration in the field. This change will not affect the total acceleration of the ion in the drift direction but can completely eliminate the dipole alignment.
While drifting and rotating, the ion can have internal vibration and possible internal rotations. As a result of the collisions with buffer gas molecules, the internal energy of the ion will be elevated. In a weak field, the ion temperature, T_{ion}, should be equal to the effective ion temperature, T_{eff}, which is the gas temperature plus a drift velocity term (to be discussed later) [25]. In typical IMS experiments, T_{ion} or T_{eff} would be close to the buffer gas temperature due to the use of low E/N ratios and drift velocities. In the MD simulations, due to the use of high E/N ratios, T_{ion} (or T_{eff}) will be higher than the gas temperature, for example, by 10 K. This level of ion temperature elevation is expected and can be precisely controlled. As a result, the simulated CCS value is for the actual T_{ion} (or equivalently, T_{eff}), not for the gas temperature.
The random diffusion of the ion in the buffer gas can lead to uncertainties in both MD simulated and experimentally measured drift velocities. In IMS experiments, a large number of ions are measured simultaneously and the drift velocity is taken as the average value (the peak position), so the diffusion uncertainty is minimized. In a single MD simulation, however, only one ion is used, so the diffusion uncertainty must be carefully considered. According to Einstein’s random walk theory, the diffusion distance of an ion (with a diffusion constant D) in the drift direction is proportional to the square root of the drift time t,
The displacement of the ion in the drift direction is proportional to the drift time t,
The D of an ion in a given buffer gas is a constant. When a proper drift velocity is used and the drift time is sufficiently long (e.g., 100 ns), the diffusion uncertainties in the MD simulation can be controlled at ∼1%, which is often sufficient because errors caused by the inaccuracies in the force field can be much larger.
In IMS experiments, the measured electrical mobility μ_{q} is often related to the collision cross section Ω by using the Mason-Schamp equation [22],
Here m_{A} is the mass of the ion, m_{B} is the mass of each buffer gas molecule, and N is the buffer gas number density (particle per unit volume). Using the experimentally measured drift velocity v, the value of Ω can be calculated,
The Mason-Schamp equation is accurate when the field and drift velocity are vanishingly low, and when the gas is thin to allow only binary collisions between the ion and gas. It is also based on the assumption that the collisions between the ion and gas are elastic. In weak fields, the Mason-Schamp equation can still be used, but the temperature should be replaced by the effective ion temperature T_{eff}, which represents the average total random energy of the drift ion [25]. Based on Wannier’s momentum and energy analysis of elastic binary collisions [26,27], T_{eff} can be defined as [25]
Here T_{gas} is the temperature of the buffer gas. Numerical results in this work suggest that the errors of the Mason-Schamp equation (with T_{eff}) are not greater than 1%–2% for T_{eff} = 300 K and T_{gas} >260 K.
III. COMPUTATIONAL METHODS
The MD method is implemented in the quantum chemistry polarizable force field (QuanPol [28]) program, which is integrated in the General Atomic and Molecular Electronic Structure System (GAMESS [29,30]).
The global minimum structures of 15 molecular ions (Fig. 2) were identified by using the Merck Molecular Force Field (MMFF94) [31–34] and a simple molecular dynamics optimization (QuanPol keyword MDOPT = 1000) method. In this MDOPT method, a MD simulation at 600 K or 700 K is run for an ion for 1 ns or longer. At every 1000 MD steps, as specified by the keyword MDOPT = 1000, the MD is paused, but not interrupted, for a steepest descendent geometry optimization to locate a minimum-energy structure. For the small ions involved in this study, all with <100 atoms, 1 ns MD simulation for the MDOPT method is usually sufficient for finding out the true global minimum. At least 1000 minimum energy structures were obtained for each ion. Some of the structures were similar in terms of structure and energy, so in the subsequent MD simulation of the ion mobility in buffer gases, these structures would all appear with some probability. The MMFF94 force field implemented in the QuanPol program is a complete implementation of the original MMFF94 method [31–34], which has bond stretching, bond angle bending, stretching-bending coupling, dihedral rotation, wagging (out-of-plane penalty), charge-charge, and a 14-7 buffered Lennard-Jones potential. The MMFF94 force field was used because it can handle a variety of organic molecules with no or very little user interference.
The MMFF94 globally optimized ion structures were then used for MD simulations of the ion mobility in He or N_{2} buffer gases. In all the simulations, 256 He atoms or N_{2} molecules were included in a cubic PBC box with a fixed side length of 61.15 Å and a volume of 228 659.57 Å^{3}. The volumes of the ions, estimated by using a density of 1.0 g cm^{−3}, were deducted from the total volume. For example, the volume of the reserpine ion (Fig. 2) was estimated as 1013 Å^{3}, which was 0.44% of the total volume. In this case, the volume available to the buffer gas molecules was estimated as 227 646.55 Å^{3}, and the number density of the buffer gas was taken as 256/227 646.55 Å^{3}. This rough estimation of the ion volume introduces a very small error, most likely <0.1%, in the gas number density. The MD simulations were performed with buffer gases at 290 K. The electric fields were selected so that they leaded to ∼100 m s^{−1} and ∼250 m s^{−1} drift velocity in N_{2} and He buffer gases, respectively, for all the cases. As a result, the effective ion temperatures T_{eff} were all controlled at 300 ± 2 K (it is not easy to control them exactly at 300 K). The average pressure was ∼48 bars for He and ∼46 bars for N_{2}. The pressure of N_{2} is slightly lower because there are stronger attractions between N_{2} molecules.
Because there are no MMFF94 force field parameters for He and N_{2}, a mixed force field was used for the ion and gas system. The partial atomic charges, bond stretching terms, bond angle bending terms, stretching-bending coupling terms, dihedral rotation terms, and wagging terms for the ion atoms were from the MMFF94 force field. In the MD simulation, the charge-charge interactions between the ion atoms were attenuated with a shifting function (QuanPol keywords ISHIFT = 4), which has important effects on the internal dynamics of the ion and can often affect the CCSs of flexible molecules by ∼7 Å^{2}. There were no charge terms and covalent terms for He and N_{2} (note a one-point model for N_{2} was used). Conventional 12-6 LJ terms were used for interactions between the ion atoms (note MMFF94 uses a buffered 14-7 LJ), between the gas atoms, and between the ion atoms and gas atoms. The 12-6 LJ potential parameters for the ion atoms are shown in Table I. These LJ parameters were similar to those in the AMBER ff14SB force field [35]. These LJ parameters are element-based and are not fine tuned for different atomic types in different molecules. Within the ion, the LJ potentials were excluded for the 1–2 and 1–3 atom pairs that were described with bond stretching and bending terms, and were fully included for the 1–4 atoms (QuanPol keywords WT14LJ = 1.0). Due to the use of PBC, a switching function was used for the LJ potential (QuanPol keywords ISWITCH = 2, SWRA = 10.0 Å, SWRB = 12.0 Å). The 12-6 LJ parameters for He and N_{2} (Table I) were selected to best match the experimental CCS values for the 15 molecules. The following combination rules were used for the LJ parameters between atoms i and j:
The dipole polarization of the He and N_{2} molecules was included by using the dipole polarizability from experiments (He = 0.2051 Å^{3}; N_{2} = 1.740 Å^{3}, see Table I) [36,37]. No polarizability points were used for the ion atoms. The QuanPol keyword IDOPOL = 1 was used, so the mutual polarization between the gas molecules was not considered. If IDOPOL = 100 is used, mutual polarization between induced dipoles will be included. The IDOPOL = 1 option is identical to the R^{−4} charge-polarizability potential commonly used in trajectory methods. Due to the use of PBC, a switching function was used for the charge-polarizability potential (QuanPol keywords IPOLSHF = 0, ISWITCH = 2, SWRA = 10.0 Å, SWRB = 12.0 Å).
The MD simulations were started from a set of initial coordinates and a set of randomly assigned velocities for the ion and gas atoms, and an applied electric field in x, y, and z directions (E_{x} = E_{y} = E_{z}, so the total field strength is 1.732E_{x}). The initial translational velocity of the ion was set to zero; the initial rotational velocities of the ion were not particularly controlled, so the values were subject to random rotations. In the applied field, the ions would need ∼100 000 fs to reach a drift velocity comparable to their terminal drift velocity. In general, the initial ∼100 000 fs MD simulation should be excluded from the drift velocity calculation. However, this is a very short time (0.1%) as compared to the total simulation time 100 000 000 fs, so the errors can be ignored. For the same reason, it is not necessary to purposely equilibrate the system before data collection if there were no overlapping atoms in the initial coordinates. Practically, overlapping atoms can be easily relaxed by running a very short time MD simulation with a small time step size such as 0.001 fs. The drift velocity was periodically printed out at every 20 000 MD steps (QuanPol keyword JOUT = 20 000, which means 20 000 fs when the MD time step size is 1 fs) by using the ion mass center coordinates at the initial step and the current step. Since the electric field was applied in the x, y, and z directions, there are three components of the drift velocity, which should converge to similar values at the end of the simulation. From the drift velocity, a single value of the CCS was calculated with Eq. (6) [using effective ion temperature T_{eff} calculated from Eq. (7)] and printed out. The diffusion constant at T_{eff} is calculated by using Eq. (2). A periodic report of the ion mass center coordinate, drift velocity, diffusion constant, and CCS values can help users monitor the progress. Because of the convergent nature of the simulation, the results at the end of the 100 ns MD simulation were taken as the best results. In the MD simulation, the average temperature of the gas molecules in the buffer region was maintained at 290 K. The effective ion temperatures T_{eff} were all controlled at 300 ± 2 K. The average temperatures of the ion (without considering the drift), T_{ion}, were also around 300 K, virtually equal to T_{eff}.
Using one computer core, it took ∼19 h to finish 100 × 10^{6} of MD steps (100 ns) with a time step size of 1 fs for the reserpine ion, the largest ion involved in this study. Because the total number of atoms is only a few hundreds in the MD system, using many computer cores would not necessarily lead to a high parallel efficiency and overall productivity using the current parallel implementation of the method.
IV. RESULTS AND DISCUSSION
Table II presents the electric field strength used in the MD simulation of ion mobility and the resulting drift velocity and T_{eff}. Table III shows a comparison of the MD simulated CCSs and the experimental CCS values for the 15 molecules (Fig. 2). A few experimental CCS values are not found in the literature, so the simulated CCS values are our theoretical predictions. The largest unsigned error in the MD simulated CCSs in He gas is 6.15 Å^{2} (for α-maltose-Na^{+} ion), with a mean unsigned error of 2.64 Å^{2} for the 12 cases with available experimental results. For N_{2} gas, the largest unsigned error in the MD simulated CCSs is 10.23 Å^{2} (for acetaminophen-H^{+} ions), with a mean unsigned error of 4.40 Å^{2} for the 14 cases with available experimental results. The largest errors seen here are most likely caused by the inaccuracies in the force field parameters (covalent terms, LJ potentials, partial atomic charges, and polarization). It is unlikely that a set of element-based (not fine tuned for different atomic types in different molecules) LJ parameters, as given in Table I, can work extremely well for atoms in very different molecules. It is also unlikely that the MMFF94 force field is the best for describing the dynamics of the ions in the CCS simulation. The larger errors for CCS values in N_{2} gas may also be partially due to the use of a one-site model for N_{2} molecules.
To better reproduce the experimental CCS values, a set of force field parameters should be calibrated, and a two-site model for N_{2} is probably necessary. In our test calculations, it is observed that for relatively rigid molecules (e.g., pyrene, tetramethyammonium, acetaminophen, and N-ethylaniline), the simulated CCSs are not very sensitive to the assignment of atomic charges. But for some flexible molecules (e.g., colchicine, ondansetron, reserpine, and verapamil), the simulated CCSs are more sensitive to the atomic charge assignment and the way the charge-charge interactions are treated (e.g., use shifting function or not, use 1–4 scaling or not) in the force field calculation of the ion atoms. These observations suggest that partial atomic charges, together with covalent terms, especially the dihedral rotation terms, can significantly affect the dynamic structures of the drift ions and their interactions with the buffer gas molecules. In the current study, the MMFF94 parameters were used due to its availability for a variety of molecules. It is observed that by slightly adjusting the LJ parameters (with the MMFF94 covalent terms and atomic charges, and the given set of LJ parameters for He and N_{2}) for a given molecular ion, the experimental CCS value can always be closely reproduced. Therefore, it is highly possible to calibrate a set of LJ parameters that can be used in the MD method to generate CCS values much closer to experiments than the results presented in Table III. A dramatic improvement has been observed in trajectory method CCS calculations for a set of rigid molecules by optimizing the LJ parameters [38]. In the current paper, the focus is to examine the possibility of using MD simulation to calculate CCS values. In forthcoming papers, the force field parameterization for obtaining better CCS results will be reported.
A trajectory method with optimized LJ parameters was used to calculate CCS values of 17 drug-like compounds [38]. The calculated CCS values in N_{2} gas for acetaminophen, N-ethylaniline, pyrene, and tetramethylammonium ions are 131.4, 124.5, 139.9, and 107.2 Å^{2}, respectively, and the calculated CCS values in He gas are 65.7, 62.4, 76.4, and 47.9 Å^{2}, respectively. These results are in excellent agreement with experiments due to the use of optimized LJ parameters, with largest errors of ∼6 Å^{2} in N_{2} gas. However, the authors did not report theoretical values for colchicine, ondansetron, reserpine, and verapamil ions using their optimized trajectory method [38]. In a recent paper, a trajectory method named Collidoscope was developed for CCS calculations [18]. The Collidoscope calculated CCS values in He gas for acetaminophen, colchicine, N-ethylaniline, ondansetron, pyrene, reserpine, tetramethylammonium, and verapamil are 69, ∼140, 63, ∼110, 80, ∼190, 50, and ∼170 Å^{2}, respectively [18]. The largest unsigned errors are ∼27 Å^{2} for the verapamil ion, ∼11 Å^{2} for the reserpine ion, and ∼9 Å^{2} for the colchicine ion (listed in Table III for comparison), which are flexible molecular ions. This comparison clearly shows that the MD method can produce much more accurate CCS values than the Collidoscope method for flexible molecular ions, probably due to the inclusion of dynamic sampling of the ion structures in the MD simulation.
Polarization of buffer gas molecules such as N_{2} in the electric field created by a drift ion can contribute significantly to the CCS value of the ion. Here five MD simulations for the α-lactose-Na^{+}, colchicine-H^{+}, mannitol-Na^{+}, ondansetron-H^{+}, and pyrene^{+} ions were performed in N_{2} gas but with no dipole polarizability for the N_{2} molecules. Other force field parameters and MD settings remained the same as described in Sec. III. Of course, this is a hypothetic examination because such N_{2} molecules do not exist. Because it was expected that the CCS would be smaller, the applied electric fields were adjusted, so T_{eff} = 300 K at T_{gas} = 290 K. The resulted CCS values are 166.07, 181.63, 125.77, 160.21, and 129.79 Å^{2}, respectively. When the dipole polarizability is used for N_{2} molecules, the values are 184.38, 194.58, 144.12, 179.14, and 144.69 Å^{2}, respectively (Table III). Clearly, the dipole polarization potential used in the MD simulation for N_{2} gas molecules can contribute about 18.31, 12.95, 18.35, 18.93, and 14.90 Å^{2} to the total CCSs for these molecular ions. The differences are caused by different charge distributions and different N_{2} accessibilities to the positively charged moieties in the molecular ions.
Figure 3 shows the convergence of the CCS of Ala-Ala-Ala-H^{+} in a 100 ns MD simulation in He gas. Five thousands of data points are used to generate Fig. 3. In the first 0.2 ns, the diffusion fluctuations are very large, so the CCSs can be as large as 200 Å^{2} (not even visible in Fig. 3 due to the small scale). Passing the initial stage, the CCS fluctuation is ∼10 Å^{2} in the first 5 ns, and progressively reduces to ∼2 Å^{2} at 40 ns. After 40 ns, the CCS is stabilized at ∼90 Å^{2}, with fluctuations around ∼1 Å^{2}. Similar behaviors are observed for all other ions in this study. The main cause of the fluctuation is random diffusion, but rotational averaging and dynamical sampling of the ion structures can also be possible causes. For non-globular ions, the experimental CCS results are the average values of all orientations. The collision of the buffer gas molecules provides the driving force for the random rotation of the drift ions. In both experiments and MD simulations, there should be sufficient time to allow the ions to rotate many rounds to achieve an adequate sampling. The characteristic rotational time can be roughly estimated by using rotational kinetic energy, which should be k_{B}T/2 in each of the three rotational degrees of freedom. This rotational kinetic energy can be converted to an angular velocity (round per second or radian per second) by using the three moments of inertia of a given ion. Here a very rough estimation is considered for the maltose-Na^{+} ion (365 g mol^{−1}, Fig. 2) by assuming it is a rigid globe with a constant mass density. The estimation is that it can rotate 1 round in every 20 000 fs (20 000 MD steps). In a 100 ns MD simulation, a maltose-Na^{+} ion could rotate about 5000 times around each of the three rotational axes. In a typical IMS experiments, a maltose-Na^{+} ion could rotate about 50 000 000 times. However, it does not mean in IMS experiments that the rotational sampling is 10 000 times better than that in the MD simulation because the numbers of ion-gas collisions are similar in both cases. Since the angular velocity is proportional to M^{−5/6} (M is the mass of the ion) for a rigid globe with a constant density, an ion with a mass 10 times larger (i.e., 3650 g mol^{−1}, such as a peptide) would rotate 6.8 times slower but still can rotate many hundreds of rounds in 100 ns. These rough estimations suggest that there is likely sufficient rotational averaging of the CCS in a 100 ns MD simulation for the ions involved in this study. For very large ions, both the IMS experimental drift time and the MD simulation time should be long enough to ensure adequate rotational samplings. In a dense buffer gas like those used in this study, an ion might show a preferential orientation to minimize the friction in the drift direction. If so, the obtained CCS would be smaller than the average value. Visual examinations of the molecular orientations revealed that none of the ions in this study showed a steady orientation in the MD simulation but did not exclude the possibility that some particular orientations might have a higher appearance probability. The convergence of the CCS of a flexible ion is also affected by the dynamic sampling of its low-energy structures and conformations. Flexible ions typically have a metal ion such as Na^{+} and hydrogen bonds between functional groups. For example, very different structures have been seen in the MD simulation of α-maltose-Na^{+}, α-lactose-Na^{+}, and β-lactose-Na^{+}. A particular structure randomly encountered in the MD simulation could be trapped for a long time (e.g., many ns) before a thermal transition could occur. Nevertheless, the convergence behavior of the CCS in a MD simulation itself can serve as an indicator whether the rotational and structural sampling is sufficient.
Ten uncorrelated MD simulations were performed for the Ala-Ala-Ala-H^{+} ion in He gas by using different initial velocities (QuanPol keyword NRANDOM = 1 forces a date and time dependent seed to be used for the random number generator in the QuanPol MD program). After 100 ns simulation for each case, the resulted CCSs are 90.80, 89.01, 88.86, 89.34, 88.42, 89.99, 91.33, 88.98, 86.91, and 87.72 Å^{2}, respectively, with a mean value of 89.14 Å^{2} and a standard deviation of 1.33 Å^{2}. Here the relative error is about 1.4%. In the first MD simulation that gives a CCS of 90.80 Å^{2}, the diffusion constant D of the Ala-Ala-Ala-H^{+} ion in the He buffer gas (pressure 46.1 bars, T_{gas} = 290 K, T_{eff} = 299.74 K) is calculated as 36 732 Å^{2} ns^{−1}, and the drift velocity is 246.32 m s^{−1} (Table II). In a 100 ns MD simulation, the random diffusion distance of an Ala-Ala-Ala-H^{+} ion is likely ±2710 Å as calculated from Eq. (3), and the drift distance is 246 320 Å as calculated from Eq. (4). Therefore, the relative error caused by random diffusion is about ±1.1%, which agrees well with the relative standard deviation of 1.4% observed in the ten MD simulations. Also, in the first MD case, the three components of the drift velocity are v_{x} = 146.49, v_{y} = 138.85, and v_{z} = 141.30 m s^{−1}, respectively, with an average value of 142.21 m s^{−1} and a standard deviation of 3.90 m s^{−1}. The relative standard deviation in the drift velocity is 2.7%, comparable to the other two measures (1.4% and 1.1%). These analyses indicate that by using 100 ns MD simulation in a field strength 1.732 × 10^{7} V m^{−1} (E_{x} = E_{y} = E_{z} = 1.0 × 10^{7} V m^{−1}) and a 46.1 bars gas pressure, the diffusion error can be controlled at a level of 1%–2%. For ions with smaller CCSs, such as tetramethylammonium (48.5 Å^{2} in He), the diffusion constant is larger, so the relative error would be larger at the same drift velocity and drift time. For ions with large CCSs, such as proteins, the diffusion errors should be smaller.
The CCSs are calculated from the Mason-Schamp equation [Eq. (6)] for the effective ion temperature T_{eff} [Eq. (7)]. The MD simulations were performed with T_{gas} = 290 K, and the electric fields were purposely selected to produce the desired drift velocities in He and N_{2}, so in all cases the T_{eff} = 300 K. In principle, different T_{gas} can be used with different fields to produce the same T_{eff}. To examine the accuracy of the Mason-Schamp equation at different T_{gas}/T_{eff} combinations, 100 ns MD simulations were performed for Ala-Ala-Ala-H^{+} ions in He and N_{2} at T_{gas} = 260, 270, 280, and 290 K, but the T_{eff} were all controlled at 300 K by applying different electric fields. To minimize the statistical errors, ten independent MD simulations were performed for each case (by using the keyword NRANDOM = 1). The resulted CCS values for T_{gas} = 260, 270, 280, 290 K are 87.78 ± 0.50, 88.47 ± 0.76, 88.28 ± 0.46, and 89.14 ± 1.33 Å^{2}, respectively, in He gas and are 157.90 ± 0.83, 158.33 ± 0.94, 159.05 ± 1.36, and 158.54 ± 2.20 Å^{2}, respectively, in N_{2} gas. The random diffusion errors are larger for higher T_{gas} because lower fields and drift velocities are used (shorter drift distances). These results suggest that the errors of the Mason-Schamp equation are not greater than 1%–2% when T_{eff} – T_{gas} < 40 K for T_{eff} near 300 K. In weak fields, the ion temperatures T_{ion} should equal to the effective ion temperature T_{eff}. For the Ala-Ala-Ala-H^{+} ion in He gas, the T_{ion} are 301.59, 303.26, 301.17, 302.02 K, and the T_{eff} are 300.14, 300.55, 300.68, 301.44 K, respectively, for T_{gas} = 290, 280, 270, 260 K. In N_{2} gas, the T_{ion} are 299.91, 299.26, 298.85, 298.79 K, and the T_{eff} are 300.14, 300.18, 300.50, 300.85 K, respectively, for T_{gas} = 290, 280, 270, 260 K. The T_{ion} are calculated from the atomic velocities of the ion (excluding drift velocity), and the T_{eff} are calculated using the T_{gas} (290, 280, 270, 260 K) plus the drift velocity terms (∼10, ∼20, ∼30, ∼40 K). These results suggest that T_{ion} and T_{eff}, calculated independently, are very close to each other when T_{eff} – T_{gas} < 40 K for T_{eff} near 300 K.
Figure 4 shows the electric field dependences of the MD simulated drift velocity and mobility for Ala-Ala-Ala-H^{+} ion in He gas (pressure about 47 bars, T_{gas} = 298.15 K, T_{eff} ranging from 300 K to 900 K). As expected, there are deviations from proportionality in the drift velocity. The deviation of the mobility from a linear behavior at high field is usually described with empirical alpha functions, which is a polynomial function of the even-order terms of the E/N ratio. As E/N increases from 0 to 150 Td, the mobility decreases from 1.5 × 10^{−5} to 1.1 × 10^{−5} m^{2} s^{−1} V^{−1}. When E/N is lower than 40 Td, the mobility is roughly a constant. At very high fields, the CCS values computed from the Mason-Schamp equation [Eq. (6)] and T_{eff} from Eq. (7) may not be accurate. In Fig. 5, the CCSs calculated using Eq. (6) and T_{eff} are plotted as a function of T_{eff}. As T_{eff} increases from 300 K to 900 K, the CCS drops by 24 Å^{2} or 26%. These results are consistent with the experimentally observed field effect on CCS, which is essentially a temperature effect [25]. At very high fields, T_{ion} becomes significantly lower than T_{eff} for Ala-Ala-Ala-H^{+} ions in He gas. For example, at T_{gas} = 298.15 K, for T_{eff} = 502 K (E/N = 77.22 Td), the T_{ion} is 504 K, virtually the same. For T_{eff} = 643 K (E/N = 108.11 Td), the T_{ion} drops to 617 K. For T_{eff} = 874 K (E/N = 154.45 Td), the T_{ion} is only 801 K. These data suggest that the T_{eff}, defined in Eq. (7), can well characterize the collision kinetics at E/N ratios as high as 77 Td for Ala-Ala-Ala-H^{+} ions in He gas.
To better simulate the temperature dependence of the CCS, T_{eff} should be close to T_{gas}, so the Mason-Schamp equation is accurate. Here a series of MD simulations were performed for Gly-Gly-Gly-Gly-H^{+} ions in He and N_{2} gases with T_{gas} = 90, 140, 190, 240, 290, 340, 390, 490, 590, and 690 K. By applying different electric fields, the T_{eff} were controlled at 100, 150, 200, 250, 300, 350, 400, 500, 600, and 700 K, respectively. The simulated CCSs are available in the supplementary material. In Fig. 6, the MD simulated CCS and the experimental values [39] are plotted. The agreement between the experimental the MD results is good for He gas in the considered temperature range (100 K–700 K). The agreement for N_{2} gas is good at high temperatures (>300 K), but the MD values are much larger than the experimental values at low temperatures (<300 K). For the Gly-Gly-Gly-Gly-H^{+} ion, the larger CCS at lower temperature is mainly due to increased contribution from long-ranged interactions [39]. Therefore, the larger deviations of the MD simulated CCS values from experiments at lower temperatures suggest that the long-ranged interaction potentials used here are not very accurate.
The final issue considered here is the buffer gas particle density. In IMS experiments, typically a low particle density N = 1 × 10^{23} m^{−3} (gas pressure ∼5 mbar) is used, so there is roughly one gas molecule in 10 000 000 Å^{3} volume. In the MD simulation described here, the gas pressure is ∼50 bars, and there is roughly one gas molecule in 1000 Å^{3} volume. As discussed earlier, for a drift ion with a radius of 8 Å (assuming globular) and a cutoff distance of 12 Å, the collision region has a radius of 20 Å and a volume about 33 510 Å^{3}. In a typical experimental condition, there are averagely 0.0034 molecules in the collision region. The chances for the drift ion to collide simultaneously with multiple gas molecules are extremely low and can be neglected. In the MD simulation, however, there are on average 34 gas molecules in the collision region, and the chances for simultaneous multiple collisions are high: the drift ion is almost always colliding with multiple gas molecules from all directions. At high gas density, the interactions between gas molecules may affect the kinetic energy distribution of the gas molecules. In addition, simultaneous multiple collisions between ion and gas molecules may occur, so the Mason-Schamp equation becomes less accurate. Numerical results suggest that effects of these simultaneous collisions are not too large to significantly affect the simulated drift velocity and CCS values. For example, in a 500 ns MD simulation of Ala-Ala-Ala-H^{+} ions in He gas with a pressure of 9.1 bars (256 He atoms in a cubic PBC box with a fixed side length of 104.565 Å) and field strength E = 0.3464 × 10^{7} V m^{−1} (the drift velocity thus is 252.72 m s^{−1}, T_{eff} = 300.25 K), the resulted CCS is 88.54 Å^{2}. In this case, the diffusion constant D of the Ala-Ala-Ala-H^{+} ion is calculated as 188 762 Å^{2} ns^{−1}. In a 500 ns MD simulation, the random diffusion distance of an Ala-Ala-Ala-H^{+} ion is likely ±13 739 Å, and the drift distance is 126 360 Å, with a relative diffusion error of ±1.1%. Considering this error, the CCS value 88.54 Å^{2} is equal to the value of 89.14 ± 1.33 Å^{2} (see earlier discussions) obtained with a He pressure of 46.1 bars and a field strength of E = 1.732 × 10^{7} V m^{−1} (the drift velocity is ∼246 m s^{−1}). One may argue that both of these cases have He gas pressures (9.1 and 46.1 bars) much higher than typical IMS He pressures (e.g., 5 mbar), so the effects of simultaneous collisions may be similarly and comparably large. Actually, because the probabilities of simultaneous collisions from two, three, and more gas molecules are proportional to the square, cubic, and higher powers of the gas particle density, a drop in the pressure by 5 times would result in roughly 25 times reduction in the effects of simultaneous collisions, if any. Therefore, it can be concluded that in a He buffer gas with a pressure of ∼50 bars, the effects on the simulated CCS values due to simultaneous multiple collisions are unlikely greater than 1 Å^{2} (or 1%) for the Ala-Ala-Ala-H^{+} ion. This conclusion should be general to other ions and other simple buffer gases, such as N_{2}.
V. CONCLUSION
A force field molecular dynamics simulation method is designed to simulate ion drift driven by an applied electric field in buffer gases He and N_{2}. By using a simulation time of 100 ns (5–19 h of computer time), collision cross section of an ion with less than 100 atoms can be obtained with reasonable accuracies. The main findings of this work are summarized:
1. Force field molecular dynamics methods can be used to directly simulate ion drift in buffer gases. The minimum image convention form of the periodic boundary condition can be used with a cutoff distance for systems consisting of a drift ion and a few hundreds of buffer gas molecules. Special velocity scaling procedures should be used to control the buffer gas temperature and translational and rotational momenta.
2. Using high buffer gas density and high electric field can shorten the MD simulation time by 10 000 times, from ∼1 ms to ∼100 ns, dramatically increasing the simulation efficiency. The errors in the CCSs due to high electric field and high drift velocity (e.g., 100–250 m s^{−1}) can be controlled at a level of 1%–2% when the effective ion temperature is 300 K and the gas temperature is 290 K. The use of high gas density has no obvious effects in the simulated CCSs.
3. The simulated CCSs are sensitive to the Lennard-Jones parameters and other force field parameters. By using a set of element-based Lennard-Jones parameters that are not tuned for different atomic types in different molecules, the simulated collision cross sections for 15 small molecular ions are consistent with experimental values: the mean unsigned error is 2.6 Å^{2} for He buffer gas and 4.4 Å^{2} for N_{2} buffer gas. It is highly possible that a set of LJ parameters, when calibrated together with a standard force field (e.g., MMFF94) for different atom types of the same elements in different functional groups, can closely reproduce experimental CCS data.
SUPPLEMENTARY MATERIAL
TABLE I. 
Atomic charges, Lennard-Jones potential, and dipole polarizability used in this study. The covalent terms are all from MMFF94.
TABLE II. 
Electric field strength E (10^{7} V m^{−1}), drift velocity v (m s^{−1}), effective temperature T_{eff} (K), and computer time (hours) in the molecular dynamics simulation of ion drift. The buffer gas temperature is 290 K. The simulated CCSs are for T_{eff}.
TABLE III. 
Molecular dynamics simulated (buffer gas at ∼50 bars and 290 K, effective ion temperature 300 K) and experimentally measured collision cross sections (Å^{2}). Results in He gas from a trajectory method (Collidoscope, Ref [18]) are also listed for comparison.
TABLE I. -body
Atom site	Description	Charge (e)	R_{min}/2 (Å)	ε (kcal/mol)	α (Å^{3})
He	He atoms in buffer gas	0	1.5000	0.0400	0.2051
N2 (single site)	N_{2} molecules in buffer gas	0	2.5000	0.1500	1.7400
H	H atoms in drift ion	MMFF94	0.6000	0.0160	0
C	C atoms in drift ion	MMFF94	1.9080	0.0860	0
N	N atoms in drift ion	MMFF94	1.8240	0.1700	0
O	O atoms in drift ion	MMFF94	1.7000	0.2000	0
Na	Na^{+} in drift ion	+1	1.5000	0.0200	0
TABLE II. -body
	He gas	N_{2} gas
Ion	E	v	T_{eff}	Time	E	v	T_{eff}	Time
α-maltose-Na^{+}	2.0785	250.94	300.11	14.0	3.4641	94.66	300.07	12.7
α-lactose-Na^{+}	2.0785	247.46	299.83	14.1	3.4641	94.22	299.98	12.9
β-lactose-Na^{+}	2.0785	248.87	299.94	10.4	3.4641	97.16	300.60	13.0
Acetaminophen-H^{+}	1.3683	255.48	300.47	8.5	2.5981	97.21	300.62	6.3
Gly-Gly-Gly-Gly-H^{+}	1.7321	255.13	300.45	7.7	3.1177	100.51	301.35	9.5
Ala-Ala-Ala-H^{+}	1.7321	246.32	299.74	9.3	2.9445	95.98	300.35	9.5
Ala-Ala-Ala-Ala-H^{+}	2.0785	262.20	301.03	11.4	3.2909	96.83	300.54	11.6
Colchicine-H^{+}	2.4249	244.96	299.63	11.8	3.8105	97.75	300.73	14.9
Mannitol-Na^{+}	1.5588	254.64	300.41	7.2	2.7713	94.25	299.98	8.6
N-ethylaniline-H^{+}	1.2124	253.83	300.34	6.1	2.2517	95.04	300.15	6.1
Ondansetron-H^{+}	2.0785	254.44	300.39	9.6	3.2909	93.00	299.72	13.4
Pyrene^{+}	1.5242	249.31	299.98	7.5	2.7713	98.73	300.95	7.6
Reserpine-H^{+}	3.4641	252.23	300.21	18.4	4.8497	93.37	299.80	19.2
Tetramethylammonium	0.9006	257.44	300.64	5.0	1.9053	97.55	300.69	6.1
Verapamil-H^{+}	2.7712	251.97	300.19	14.5	3.9837	94.71	300.08	18.0
TABLE III. -body
Ion	m (amu)	q (e)	TM [18]	MD	Expt.	MD	Expt.	Expt. ref.
			He	He	He	N_{2}	N_{2}	
α-maltose-Na^{+}	365.1	+1	NA	106.45	112.6	183.50	NA	 [40]
α-lactose-Na^{+}	365.1	+1	NA	108.00	NA	184.38	178.1	 [41]
β-lactose-Na^{+}	365.1	+1	NA	107.37	NA	178.60	178.1	 [41]
Acetaminophen-H^{+}	152.1	+1	69	69.42	67.0	140.63	130.4	 [38]
Gly-Gly-Gly-Gly-H^{+}	247.1	+1	NA	87.51	83.0	157.95	155.1	 [39]
Ala-Ala-Ala-H^{+}	232.1	+1	NA	90.80	89	157.01	151	 [42]
Ala-Ala-Ala-Ala-H^{+}	303.2	+1	NA	101.89	100	171.58	166	 [42]
Colchicine-H^{+}	400.3	+1	∼140	127.24	130.8	194.58	196.2	 [38]
Mannitol-Na^{+}	205.1	+1	NA	75.13	NA	144.12	140.6	 [41]
N-ethylaniline-H^{+}	122.1	+1	63	62.14	63.0	127.14	124.5	 [38]
Ondansetron-H^{+}	294.2	+1	∼110	105.13	105.9	179.14	172.7	 [38]
Pyrene^{+}	202.1	+1	80	79.03	76.4	144.69	135.0	 [38]
Reserpine-H^{+}	609.4	+1	∼190	175.79	178.8	256.34	254.3	 [38]
Tetramethylammonium	74.1	+1	50	45.97	48.5	110.91	107.4	 [38]
Verapamil-H^{+}	455.4	+1	∼170	141.09	142.6	209.26	210.0	 [38]
Maximum unsigned error			∼27	6.15		10.23		
Mean unsigned error			∼7.3	2.64		4.40		
FIG. 1. 
Molecular dynamics simulation of ion mobility is performed with the minimum image convention form of periodic boundary condition on buffer gas atoms or molecules (He or N_{2}). The size of the periodic boundary condition box is fixed, so the gas particle density is a constant. The collision region consists of gas particles close (e.g., within 12 Å) to the ion atoms. The buffer region consists of all other gas particles. Gas atoms/molecules can move in and out of the collision region freely, so a check is made at every step. In the simulation, the ion is driven by an external electric field (typically 10^{7} V m^{−1}) to drift in the buffer gas, which has a pressure of about 50 bars. In addition to drift, the ion can rotate, and internally vibrate and rotate. The motion of the gas molecules in the buffer region is controlled, so they show random thermal motions with no net translation and rotation. The simulated drift velocity of the ion is used to calculate the collision cross section via the Mason-Schamp equation.
FIG. 2. 
The initial structures of the ions used in the molecular dynamics simulation of ion mobility and collision cross section. These structures are the global minimum on the MMFF94 force field potential energy surface. The coordinates of the ions are available in the supplementary material.
FIG. 3. 
The convergence of molecular dynamics simulated collision cross section (CCS) of Ala-Ala-Ala-H^{+} in He gas.
FIG. 4. 
The MD simulated drift velocity and mobility (10^{−5} m^{2} s^{−1} V^{−1}) of Ala-Ala-Ala-H^{+} in He gas as functions of the applied electric field and E/N ratio.
FIG. 5. 
The MD simulated collision cross section (CCS) of Ala-Ala-Ala-H^{+} in He gas as a function of the effective temperature T_{eff} (but T_{gas} = 298.15 K). When T_{eff} is much higher than T_{gas}, the CCS calculated from the Mason-Schamp equation for the T_{eff} may not be accurate.
FIG. 6. 
Temperature dependence of collision cross section (CCS) of Gly-Gly-Gly-Gly-H^{+} in He and N_{2} gases. The experimental values are taken from Ref [39]. The larger deviations between experimental and MD values at low temperatures are likely caused by the inaccuracies in the force field (the induced-dipole potential and the Lennard-Jones potential).
